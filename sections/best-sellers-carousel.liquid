{% comment %}
  Best Sellers Carousel — MyCharms
{% endcomment %}

<section class="mc-bs">
  <div class="mc-bs__head">
    {% if section.settings.subtitle != blank %}
      <span class="mc-bs__kicker">{{ section.settings.subtitle }}</span>
    {% endif %}
    {% if section.settings.title != blank %}
      <h2 class="mc-bs__title">{{ section.settings.title }}</h2>
    {% endif %}
  </div>

  {% assign coll = collections[section.settings.collection] %}
  {% if coll and coll.products_count > 0 %}
    <div class="mc-bs__rail-wrap">
      {% if section.settings.show_arrows %}
        <button class="mc-bs__arrow mc-bs__arrow--prev" aria-label="Anterior" data-dir="-1">‹</button>
        <button class="mc-bs__arrow mc-bs__arrow--next" aria-label="Próximo" data-dir="1">›</button>
      {% endif %}

      <div class="mc-bs__rail" id="rail-{{ section.id }}">
        {% for product in coll.products limit: section.settings.limit %}
          <article class="mc-bs__card snap-start">
            <a class="mc-bs__imglink" href="{{ product.url }}">
              <div class="mc-bs__media">
                {% assign fm = product.featured_media %}
                {% if fm %}
                  {{ fm | image_url: width: 900 | image_tag:
                    loading: 'lazy',
                    widths: '360,540,720,900',
                    sizes: '(max-width: 749px) 70vw, 22vw',
                    alt: product.title,
                    class: 'mc-bs__img' }}
                {% else %}
                  <div class="mc-bs__ph">MyCharms</div>
                {% endif %}
                {% if product.compare_at_price > product.price %}
                  <span class="mc-bs__badge">Promo</span>
                {% endif %}
              </div>
            </a>

            <div class="mc-bs__info">
              <h3 class="mc-bs__name">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>

              <div class="mc-bs__price">
                <span class="now">
                  {% if product.price_varies %}
                    {{ 'products.product.from_text_html' | t: price: product.price | money }}
                  {% else %}
                    {{ product.price | money }}
                  {% endif %}
                </span>
                {% if product.compare_at_price > product.price %}
                  <span class="was">{{ product.compare_at_price | money }}</span>
                {% endif %}
              </div>

              {% if section.settings.show_quick_add and product.available %}
                <button class="mc-bs__btn" data-handle="{{ product.handle }}">Adicionar</button>
              {% else %}
                <a class="mc-bs__btn mc-bs__btn--ghost" href="{{ product.url }}">Ver produto</a>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      </div>
    </div>
  {% else %}
    <p class="mc-bs__empty">Escolha uma coleção com produtos.</p>
  {% endif %}

  <style>
    :root { --mc-pink:#ff9ccd; --mc-ink:#111; --mc-muted:#6b7280; --mc-ring:rgba(255,156,205,.35); }
    .mc-bs { padding: 28px 0 8px; }
    .mc-bs__head { text-align:center; margin: 0 16px 14px; }
    .mc-bs__kicker { display:inline-block; font-size:.78rem; letter-spacing:.12em; text-transform:uppercase; color:var(--mc-muted); }
    .mc-bs__title { margin:.25rem 0 0; font-size:clamp(1.25rem,2.6vw,1.8rem); }
    .mc-bs__rail { display:grid; grid-auto-flow:column; grid-auto-columns: minmax(64%, 1fr); gap:14px; overflow:auto; scroll-snap-type:x mandatory; padding:4px 16px 8px; }
    @media (min-width:540px){ .mc-bs__rail{ grid-auto-columns: minmax(42%,1fr);} }
    @media (min-width:990px){ .mc-bs__rail{ grid-auto-columns: minmax(24%,1fr);} }
    .mc-bs__card { background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:18px; overflow:hidden; scroll-snap-align:start; box-shadow:0 6px 20px rgba(0,0,0,.06); }
    .mc-bs__media{ position:relative; aspect-ratio:1/1; background:#f9f9fb; }
    .mc-bs__img{ width:100%; height:100%; object-fit:contain; }
    .mc-bs__badge{ position:absolute; top:10px; left:10px; background:var(--mc-pink); padding:.3rem .5rem; border-radius:999px; font-size:.7rem; }
    .mc-bs__info{ padding:10px 12px 14px; }
    .mc-bs__name{ font-size:.95rem; margin:0 0 .35rem; }
    .mc-bs__price{ display:flex; gap:.5rem; }
    .mc-bs .was{ text-decoration:line-through; opacity:.55; }
    .mc-bs__btn{ margin-top:.6rem; width:100%; border:1px solid var(--mc-ink); background:var(--mc-ink); color:#fff; padding:.6rem; border-radius:12px; font-size:.8rem; }
    .mc-bs__btn--ghost{ background:#fff; border:1px solid var(--mc-ink); color:var(--mc-ink); text-align:center; padding:.6rem; border-radius:12px; display:block; }
  </style>
</section>

{% schema %}
{
  "name": "Mais vendidos (Carrossel)",
  "settings": [
    { "type": "text", "id": "subtitle", "label": "Subtítulo", "default": "TOP VENDIDOS" },
    { "type": "text", "id": "title", "label": "Título", "default": "Favoritos da MyCharms" },
    { "type": "collection", "id": "collection", "label": "Coleção" },
    { "type": "range", "id": "limit", "label": "Qtd. de itens", "min": 4, "max": 20, "step": 1, "default": 12 },
    { "type": "checkbox", "id": "show_arrows", "label": "Mostrar setas", "default": true },
    { "type": "checkbox", "id": "show_quick_add", "label": "Botão Adicionar rápido", "default": true },
    { "type": "checkbox", "id": "show_view_all", "label": "Mostrar botão \"Ver todos\"", "default": true },
    { "type": "checkbox", "id": "force_best_selling_link", "label": "Forçar ?sort_by=best-selling no link", "default": true },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    {
      "type": "select",
      "id": "autoplay_ms",
      "label": "Velocidade autoplay (ms)",
      "default": "4000",
      "options": [
        { "value": "2500", "label": "2,5 s" },
        { "value": "3000", "label": "3 s" },
        { "value": "4000", "label": "4 s" },
        { "value": "5000", "label": "5 s" },
        { "value": "8000", "label": "8 s" },
        { "value": "9000", "label": "9 s" }
      ]
    }
  ],
  "presets": [
    { "name": "Mais vendidos (Carrossel)", "category": "Produtos" }
  ]
}
{% endschema %}
