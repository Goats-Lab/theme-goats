{% comment %}
  TIKTOK – Carrossel (Embed) • MyCharms
  • Usa o color_scheme do tema
  • Accent controlado por setting "brand_color" (default #ff9ccd)
{% endcomment %}

<section
  class="section-spacing tiktok-carousel color-scheme color-scheme--{{ section.settings.color_scheme.id }}"
  style="
    --gap: {{ section.settings.gap }}px;
    --item-w-mobile: {{ section.settings.item_w_mobile }}%;
    --item-w-desktop: {{ section.settings.item_w_desktop }}%;
    --radius: {{ section.settings.radius }}px;
    --brand: {{ section.settings.brand_color }};
  "
>
  <div class="container container--xl">
    {% if section.settings.title != blank or section.settings.subtitle != blank or section.settings.kicker != blank %}
      <div class="tk-header" style="text-align: {{ section.settings.heading_align }};">
        {% if section.settings.kicker != blank %}
          <p class="tk-kicker h6">{{ section.settings.kicker }}</p>
        {% endif %}

        {% if section.settings.title  != blank %}
          <h2 class="tk-title h2">{{ section.settings.title }}</h2>
        {% endif %}

        {% if section.settings.subtitle != blank %}
          <p class="tk-subtitle prose">{{ section.settings.subtitle }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="tk-wrap">
      {% if section.settings.show_arrows %}
        <button class="tk-arrow tk-prev" type="button" aria-label="Anterior">
          <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
            <path fill="currentColor" d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
          </svg>
        </button>
      {% endif %}

      <div class="tk-track" id="tk-{{ section.id }}" tabindex="0">
        {% for block in section.blocks %}
          <article class="tk-item" {{ block.shopify_attributes }}>
            <div class="tk-embed">
              {{ block.settings.embed_code }}
            </div>

            {% if block.settings.caption != blank %}
              <p class="tk-caption">{{ block.settings.caption }}</p>
            {% endif %}
          </article>
        {% endfor %}
      </div>

      {% if section.settings.show_arrows %}
        <button class="tk-arrow tk-next" type="button" aria-label="Próximo">
          <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
            <path fill="currentColor" d="m10 6 1.41 1.41L7.83 11H18v2H7.83l3.58 3.59L10 18l-6-6z"/>
          </svg>
        </button>
      {% endif %}
    </div>
  </div>
</section>

<style>
.tiktok-carousel {
  position: relative;
}

/* Header no estilo MyCharms: kicker delicado, título forte, subtítulo mais soft */
.tiktok-carousel .tk-header {
  max-width: 640px;
  margin: 0 auto 2rem auto;
}

.tiktok-carousel .tk-kicker {
  letter-spacing: .08em;
  text-transform: uppercase;
  font-size: var(--text-xs);
  opacity: .7;
  margin-bottom: .25rem;
}

.tiktok-carousel .tk-title {
  margin-bottom: .35rem;
}

.tiktok-carousel .tk-subtitle {
  opacity: .8;
  font-size: var(--text-sm);
}

/* Track */
.tiktok-carousel .tk-wrap {
  position: relative;
}

.tiktok-carousel .tk-track {
  display: flex;
  gap: var(--gap, 16px);
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x mandatory;
  scroll-padding-inline: 1rem;
  padding: 0.5rem 0.25rem 0.75rem;
}

.tiktok-carousel .tk-track::-webkit-scrollbar {
  height: 6px;
}

.tiktok-carousel .tk-track::-webkit-scrollbar-thumb {
  background: var(--brand);
  border-radius: 999px;
}

.tiktok-carousel .tk-track::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.04);
  border-radius: 999px;
}

.tiktok-carousel .tk-item {
  flex: 0 0 var(--item-w-mobile, 88%);
  scroll-snap-align: start;
  min-width: 240px;
}

@media (min-width: 900px) {
  .tiktok-carousel .tk-item {
    flex-basis: var(--item-w-desktop, 32%);
  }
}

/* Card do TikTok com vibe MyCharms: borda suave + sombra leve */
.tiktok-carousel .tk-embed {
  border-radius: var(--radius, 14px);
  border: 1px solid rgba(0,0,0,0.04);
  overflow: hidden;
  background: #ffffff;
  min-height: 320px;
  box-shadow:
    0 10px 25px rgba(0,0,0,0.04),
    0 0 0 1px rgba(255,156,205,0.05);
}

.tiktok-carousel .tk-caption {
  margin-top: 0.5rem;
  font-size: var(--text-xs);
  line-height: 1.4;
  opacity: .85;
}

/* Arrows no accent rosa MyCharms */
.tiktok-carousel .tk-arrow {
  position: absolute;
  top: 45%;
  transform: translateY(-50%);
  z-index: 2;
  width: 40px;
  height: 40px;
  border-radius: 999px;
  border: 0;
  background: var(--brand);
  color: #fff;
  display: grid;
  place-items: center;
  cursor: pointer;
  box-shadow: 0 10px 25px rgba(255,156,205,0.4);
  transition:
    transform .15s ease,
    opacity .2s ease,
    box-shadow .2s ease,
    filter .2s ease;
}

.tiktok-carousel .tk-arrow:hover {
  transform: translateY(-50%) scale(1.04);
  box-shadow: 0 12px 28px rgba(255,156,205,0.55);
  filter: brightness(1.03);
}

.tiktok-carousel .tk-prev { left: -4px; }
.tiktok-carousel .tk-next { right: -4px; }

@media (max-width: 749px) {
  .tiktok-carousel .tk-prev { left: 4px; }
  .tiktok-carousel .tk-next { right: 4px; }
}

/* Some arrows no mobile touch (mantém só swipe) */
@media (hover: none) {
  .tiktok-carousel .tk-arrow {
    display: none;
  }
}

/* Acessibilidade foco */
.tiktok-carousel .tk-track:focus {
  outline: 2px solid var(--brand);
  outline-offset: 3px;
  border-radius: 12px;
}
</style>

{% schema %}
{
  "name": "TikTok Carousel",
  "settings": [
    { "type": "color_scheme", "id": "color_scheme", "label": "Esquema de cores" },

    { "type": "text", "id": "kicker", "label": "Kicker (pequeno)", "default": "Feedbacks reais" },
    { "type": "text", "id": "title", "label": "Título", "default": "O que a galera posta no TikTok" },
    { "type": "textarea", "id": "subtitle", "label": "Subtítulo", "default": "Conteúdo criado por clientes e pela nossa equipe." },

    {
      "type": "select",
      "id": "heading_align",
      "label": "Alinhamento do título",
      "default": "center",
      "options": [
        { "value": "left", "label": "Esquerda" },
        { "value": "center", "label": "Centro" },
        { "value": "right", "label": "Direita" }
      ]
    },

    {
      "type": "color",
      "id": "brand_color",
      "label": "Cor de destaque (TikTok)",
      "default": "#ff9ccd"
    },

    { "type": "checkbox", "id": "show_arrows", "label": "Mostrar setas", "default": true },
    { "type": "range", "id": "gap", "min": 8, "max": 32, "step": 2, "label": "Espaçamento entre cards (px)", "default": 16 },
    { "type": "range", "id": "radius", "min": 0, "max": 24, "step": 2, "label": "Arredondamento dos cantos (px)", "default": 14 },
    { "type": "range", "id": "item_w_mobile", "min": 60, "max": 100, "step": 2, "label": "Largura do card no mobile (%)", "default": 88 },
    { "type": "range", "id": "item_w_desktop", "min": 20, "max": 50, "step": 2, "label": "Largura do card no desktop (%)", "default": 32 }
  ],
  "blocks": [
    {
      "type": "embed",
      "name": "Código TikTok",
      "settings": [
        {
          "type": "textarea",
          "id": "embed_code",
          "label": "Código de incorporação",
          "info": "Cole o <blockquote class='tiktok-embed'>…</blockquote> do TikTok (vídeo, perfil, hashtag)."
        },
        { "type": "text", "id": "caption", "label": "Legenda curta (opcional)" }
      ]
    }
  ],
  "presets": [
    { "name": "TikTok Carousel", "category": "Social" }
  ]
}
{% endschema %}

{%- comment -%} Necessário para todos os embeds do TikTok {%- endcomment -%}
<script async src="https://www.tiktok.com/embed.js"></script>

{%- comment -%} Setas movem 1 card por vez {%- endcomment -%}
<script>
(() => {
  const track = document.getElementById('tk-{{ section.id }}');
  if (!track) return;

  function stepWidth() {
    const item = track.querySelector('.tk-item');
    if (!item) return 300;
    const styles = getComputedStyle(track);
    const gap = parseFloat(styles.gap || 0);
    return item.getBoundingClientRect().width + gap;
  }

  function go(dir) {
    track.scrollBy({ left: dir * stepWidth(), behavior: 'smooth' });
  }

  const root = document.getElementById('shopify-section-{{ section.id }}');
  const prev = root ? root.querySelector('.tk-prev') : null;
  const next = root ? root.querySelector('.tk-next') : null;

  if (prev) prev.addEventListener('click', () => go(-1));
  if (next) next.addEventListener('click', () => go(1));
})();
</script>
