{%- unless request.page_type == 'captcha' or section.settings.show_only_on_index and template != 'index' -%}
  {%- unless section.settings.hide_for_account_holders and customer -%}

    {%- comment -%}
    ESTILO POPUP COMUNIDADE MYCHARMS (fundo escuro + bot√µes rosa vibrante)
    {%- endcomment -%}
    <style>
      #shopify-section-{{ section.id }} .newsletter-popup {
        max-width: 380px;
        margin: 0 auto;
      }

      #shopify-section-{{ section.id }} .mc-popup {
        background:
          radial-gradient(circle at top left, rgba(255, 120, 200, 0.35) 0, transparent 45%),
          radial-gradient(circle at bottom right, rgba(255, 120, 200, 0.25) 0, transparent 45%),
          #050816;
        border-radius: 24px;
        padding: 2.4rem 2rem 2rem;
        color: #f9fafb;
        box-shadow:
          0 18px 45px rgba(0, 0, 0, 0.65),
          0 0 30px rgba(255, 77, 160, 0.35);
        position: relative;
      }

      #shopify-section-{{ section.id }} .mc-popup__title {
        font-size: 1.3rem;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        color: #fdf2ff;
      }

      #shopify-section-{{ section.id }} .mc-popup__title span {
        display: block;
      }

      #shopify-section-{{ section.id }} .mc-popup__text {
        color: #e5e7eb;
        font-size: 0.9rem;
      }

      #shopify-section-{{ section.id }} .mc-popup__text p {
        margin: 0;
      }

      #shopify-section-{{ section.id }} .mc-popup__buttons {
        display: flex;
        gap: 0.75rem;
        margin-top: 0.75rem;
      }

      #shopify-section-{{ section.id }} .mc-popup__btn {
        flex: 1 1 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.85rem 0.4rem;
        border-radius: 999px;
        text-decoration: none;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-size: 0.78rem;
        font-weight: 700;
        border: none;
        color: #fff;
        background: linear-gradient(90deg, #ff9ad0 0%, #ff4fb7 100%);
        box-shadow:
          0 8px 20px rgba(255, 77, 160, 0.55),
          0 0 16px rgba(255, 77, 160, 0.4);
        transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.15s ease;
        white-space: nowrap;
      }

      #shopify-section-{{ section.id }} .mc-popup__btn:hover {
        transform: translateY(-2px);
        box-shadow:
          0 10px 26px rgba(255, 77, 160, 0.75),
          0 0 20px rgba(255, 77, 160, 0.5);
        opacity: 0.96;
      }

      #shopify-section-{{ section.id }} .mc-popup__helper {
        margin-top: 0.9rem;
        font-size: 0.8rem;
        color: #d1d5db;
      }

      #shopify-section-{{ section.id }} .mc-popup__helper strong,
      #shopify-section-{{ section.id }} .mc-popup__helper b {
        color: #ffffff;
      }

      #shopify-section-{{ section.id }} .pop-in__close-button {
        color: #f9fafb;
      }

      @media (max-width: 480px) {
        #shopify-section-{{ section.id }} .mc-popup {
          padding-inline: 1.4rem;
        }

        #shopify-section-{{ section.id }} .mc-popup__buttons {
          flex-direction: column;
        }

        #shopify-section-{{ section.id }} .mc-popup__btn {
          width: 100%;
        }
      }
    </style>

    <newsletter-popup
      class="pop-in newsletter-popup color-scheme color-scheme--{{ section.settings.color_scheme.id }}"
      title="Comunidade MyCharms"
      {% if section.settings.show_only_once %}only-once{% endif %}
      apparition-delay="{{ section.settings.apparition_delay }}"
      handle-editor-events
    >
      <dialog-close-button class="contents">
        <button class="pop-in__close-button tap-area">
          <span class="sr-only">{{ 'general.accessibility.close' | t }}</span>
          {%- render 'icon' with 'close' -%}
        </button>
      </dialog-close-button>

      <div class="v-stack gap-6 mc-popup">
        {%- if section.settings.title != blank or section.settings.content != blank -%}
          <div class="v-stack gap-4 text-center">
            {%- if section.settings.title != blank -%}
              <p class="h4 mc-popup__title">
                {{ section.settings.title }}
              </p>
            {%- endif -%}

            {%- if section.settings.content != blank -%}
              <div class="prose mc-popup__text">
                {{ section.settings.content }}
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}

        <div class="v-stack gap-3">
          <div class="mc-popup__buttons">
            {%- if section.settings.instagram_url != blank -%}
              <a
                href="{{ section.settings.instagram_url }}"
                class="mc-popup__btn"
                target="_blank"
                rel="noopener"
              >
                {{ section.settings.instagram_button_text }}
              </a>
            {%- endif -%}

            {%- if section.settings.whatsapp_url != blank -%}
              <a
                href="{{ section.settings.whatsapp_url }}"
                class="mc-popup__btn"
                target="_blank"
                rel="noopener"
              >
                {{ section.settings.whatsapp_button_text }}
              </a>
            {%- endif -%}
          </div>

          {%- if section.settings.helper_text != blank -%}
            <p class="mc-popup__helper text-center">
              {{ section.settings.helper_text }}
            </p>
          {%- endif -%}

          {%- if section.settings.show_only_once -%}
            <script>
              // Marca como "preenchido" quando o usu√°rio clicar em qualquer bot√£o
              document.addEventListener('click', function (event) {
                var target = event.target.closest('a');
                if (!target) return;
                if (target.closest('newsletter-popup')) {
                  try {
                    localStorage.setItem('theme:popup-filled', 'true');
                  } catch (e) {}
                }
              }, { passive: true });
            </script>
          {%- endif -%}
        </div>
      </div>
    </newsletter-popup>
  {%- endunless -%}
{%- endunless -%}

{% schema %}
{
  "name": "Popup comunidade MyCharms",
  "class": "shopify-section--popup",
  "settings": [
    {
      "type": "paragraph",
      "content": "Convide clientes para entrar na comunidade do Instagram e WhatsApp para receber novidades, atualiza√ß√µes e cupons exclusivos."
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:global.colors.scheme",
      "default": "scheme-3"
    },
    {
      "type": "range",
      "id": "apparition_delay",
      "min": 0,
      "max": 15,
      "step": 1,
      "unit": "sec",
      "label": "Tempo para aparecer (segundos)",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_only_on_index",
      "label": "Mostrar apenas na p√°gina inicial",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "hide_for_account_holders",
      "label": "Esconder para clientes logados",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_only_once",
      "label": "Mostrar apenas uma vez por visitante",
      "default": true
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "T√≠tulo",
      "default": "Entre para a Comunidade MyCharms üíï"
    },
    {
      "type": "inline_richtext",
      "id": "content",
      "label": "Texto",
      "default": "Entre na nossa comunidade exclusiva do Instagram e do WhatsApp para receber em primeira m√£o novidades, reposi√ß√µes, lan√ßamentos e cupons secretos. ‚ú®"
    },
    {
      "type": "text",
      "id": "instagram_url",
      "label": "Link da comunidade no Instagram",
      "default": "https://www.instagram.com/channel/AbZRHtqyJ2f76Zvw/"
    },
    {
      "type": "text",
      "id": "instagram_button_text",
      "label": "Texto do bot√£o Instagram",
      "default": "GRUPO INSTAGRAM"
    },
    {
      "type": "text",
      "id": "whatsapp_url",
      "label": "Link da comunidade no WhatsApp",
      "default": "https://whatsapp.com/channel/0029VbAy6Ix0gcfA9FBlhA2y"
    },
    {
      "type": "text",
      "id": "whatsapp_button_text",
      "label": "Texto do bot√£o WhatsApp",
      "default": "CANAL WHATSAPP"
    },
    {
      "type": "inline_richtext",
      "id": "helper_text",
      "label": "Texto auxiliar",
      "default": "Lan√ßaremos cupons na <b>Black Friday</b>, fique de olho! ‚ú®"
    }
  ]
}
{% endschema %}
