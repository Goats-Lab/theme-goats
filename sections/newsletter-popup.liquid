{%- unless request.page_type == 'captcha' or section.settings.show_only_on_index and template != 'index' -%}
  {%- unless section.settings.hide_for_account_holders and customer -%}
    <newsletter-popup
      class="pop-in newsletter-popup color-scheme color-scheme--{{ section.settings.color_scheme.id }}"
      title="Comunidade MyCharms"
      {% if section.settings.show_only_once %}only-once{% endif %}
      apparition-delay="{{ section.settings.apparition_delay }}"
      handle-editor-events
    >
      <dialog-close-button class="contents">
        <button class="pop-in__close-button tap-area">
          <span class="sr-only">{{ 'general.accessibility.close' | t }}</span>
          {%- render 'icon' with 'close' -%}
        </button>
      </dialog-close-button>

      <div class="v-stack gap-8">
        {%- if section.settings.title != blank or section.settings.content != blank -%}
          <div class="v-stack gap-4 text-center">
            {%- if section.settings.title != blank -%}
              <p class="h4">{{ section.settings.title }}</p>
            {%- endif -%}

            {%- if section.settings.content != blank -%}
              <div class="prose">
                {{ section.settings.content }}
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}

        <div class="v-stack gap-4">
          <div class="h-stack justify-center gap-4 text-center" style="width:100%; justify-content:center;">
            {%- if section.settings.instagram_url != blank -%}
              {%- render 'button',
                href: section.settings.instagram_url,
                content: section.settings.instagram_button_text
              -%}
            {%- endif -%}

            {%- if section.settings.whatsapp_url != blank -%}
              {%- render 'button',
                href: section.settings.whatsapp_url,
                content: section.settings.whatsapp_button_text
              -%}
            {%- endif -%}
          </div>

          {%- if section.settings.helper_text != blank -%}
            <p class="text-subdued text-center">
              {{ section.settings.helper_text }}
            </p>
          {%- endif -%}

          {%- if section.settings.show_only_once -%}
            <script>
              // Marca como "preenchido" quando o usu√°rio clicar em qualquer bot√£o
              document.addEventListener('click', function (event) {
                var target = event.target.closest('a');
                if (!target) return;
                if (target.closest('newsletter-popup')) {
                  try {
                    localStorage.setItem('theme:popup-filled', 'true');
                  } catch(e) {}
                }
              }, { passive: true });
            </script>
          {%- endif -%}
        </div>
      </div>
    </newsletter-popup>
  {%- endunless -%}
{%- endunless -%}

{% schema %}
{
  "name": "Popup comunidade MyCharms",
  "class": "shopify-section--popup",
  "settings": [
    {
      "type": "paragraph",
      "content": "Convide clientes para entrar na comunidade do Instagram e WhatsApp para receber novidades, atualiza√ß√µes e cupons exclusivos."
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:global.colors.scheme",
      "default": "scheme-3"
    },
    {
      "type": "range",
      "id": "apparition_delay",
      "min": 0,
      "max": 15,
      "step": 1,
      "unit": "sec",
      "label": "Tempo para aparecer (segundos)",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_only_on_index",
      "label": "Mostrar apenas na p√°gina inicial",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "hide_for_account_holders",
      "label": "Esconder para clientes logados",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_only_once",
      "label": "Mostrar apenas uma vez por visitante",
      "default": true
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "T√≠tulo",
      "default": "Entre para a comunidade MyCharms üíï"
    },
    {
      "type": "inline_richtext",
      "id": "content",
      "label": "Texto",
      "default": "Entre na nossa comunidade exclusiva do Instagram e do WhatsApp para receber em primeira m√£o novidades, atualiza√ß√µes de reposi√ß√£o, lan√ßamentos e cupons secretos. ‚ú®"
    },
    {
      "type": "text",
      "id": "instagram_url",
      "label": "Link da comunidade no Instagram",
      "default": "https://instagram.com/mycharms"
    },
    {
      "type": "text",
      "id": "instagram_button_text",
      "label": "Texto do bot√£o Instagram",
      "default": "Entrar na comunidade do Instagram"
    },
    {
      "type": "text",
      "id": "whatsapp_url",
      "label": "Link da comunidade no WhatsApp",
      "default": "https://wa.me/SEU_NUMERO_OU_GRUPO"
    },
    {
      "type": "text",
      "id": "whatsapp_button_text",
      "label": "Texto do bot√£o WhatsApp",
      "default": "Entrar na comunidade do WhatsApp"
    },
    {
      "type": "inline_richtext",
      "id": "helper_text",
      "label": "Texto auxiliar",
      "default": "L√° voc√™ recebe cupons rel√¢mpago, novidades e bastidores da MyCharms em primeira m√£o. üíé"
    }
  ]
}
{% endschema %}
