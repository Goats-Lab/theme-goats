{%- unless request.page_type == 'captcha' or section.settings.show_only_on_index and template != 'index' -%}
  {%- unless section.settings.hide_for_account_holders and customer -%}
    <newsletter-popup
      class="pop-in newsletter-popup color-scheme color-scheme--{{ section.settings.color_scheme.id }}"
      title="Comunidade MyCharms"
      {% if section.settings.show_only_once %}only-once{% endif %}
      apparition-delay="{{ section.settings.apparition_delay }}"
      handle-editor-events
    >
      <dialog-close-button class="contents">
        <button class="pop-in__close-button tap-area">
          <span class="sr-only">{{ 'general.accessibility.close' | t }}</span>
          {%- render 'icon' with 'close' -%}
        </button>
      </dialog-close-button>

      <div class="v-stack gap-8" style="text-align:center; width:100%;">
        
        {%- if section.settings.title != blank or section.settings.content != blank -%}
          <div class="v-stack gap-4 text-center">
            {%- if section.settings.title != blank -%}
              <p class="h4">{{ section.settings.title }}</p>
            {%- endif -%}

            {%- if section.settings.content != blank -%}
              <div class="prose" style="text-align:center;">
                {{ section.settings.content }}
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}

        <!-- BOTÃ•ES CENTRALIZADOS -->
        <div class="h-stack gap-4" style="justify-content:center; width:100%; text-align:center;">
          {%- if section.settings.instagram_url != blank -%}
            {%- render 'button',
              href: section.settings.instagram_url,
              content: section.settings.instagram_button_text
            -%}
          {%- endif -%}

          {%- if section.settings.whatsapp_url != blank -%}
            {%- render 'button',
              href: section.settings.whatsapp_url,
              content: section.settings.whatsapp_button_text
            -%}
          {%- endif -%}
        </div>

        {%- if section.settings.helper_text != blank -%}
          <p class="text-subdued text-center">
            {{ section.settings.helper_text }}
          </p>
        {%- endif -%}

        {%- if section.settings.show_only_once -%}
          <script>
            document.addEventListener('click', function (event) {
              var target = event.target.closest('a');
              if (!target) return;
              if (target.closest('newsletter-popup')) {
                try { localStorage.setItem('theme:popup-filled', 'true'); } catch(e) {}
              }
            }, { passive: true });
          </script>
        {%- endif -%}
      </div>

      <!-- ESTILO PARA ALINHAMENTO E RESPONSIVIDADE -->
      <style>
        newsletter-popup a.button {
          text-align: center !important;
          min-width: 180px;
          padding-left: 20px;
          padding-right: 20px;
        }

        newsletter-popup .h-stack {
          display: flex;
          align-items: center;
          justify-content: center;
        }

        @media (max-width: 600px) {
          newsletter-popup .h-stack {
            flex-direction: column !important;
            gap: 12px !important;
          }
          newsletter-popup a.button {
            width: 100% !important;
          }
        }
      </style>

    </newsletter-popup>
  {%- endunless -%}
{%- endunless -%}
