{%- comment -%}
----------------------------------------------------------------------------------------------------------------------
PRODUCT PRICE (com Pix + 2x sem juros)
----------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

{%- liquid
  case context
    when 'card' or 'line_item'
      assign base_text_class = ''
      if settings.product_card_text_font == 'heading'
        assign base_text_class = 'h6 '
      endif
      assign regular_price_classes = base_text_class | append: 'text-subdued'
      assign on_sale_price_classes = base_text_class | append: 'text-on-sale'
      assign compare_at_price_classes = base_text_class | append: 'text-subdued line-through'
      assign unit_price_classes = base_text_class | append: 'text-subdued'
    when 'product'
      assign regular_price_classes = base_text_class | append: 'h4 text-subdued'
      assign on_sale_price_classes = base_text_class | append: 'h4 text-on-sale'
      assign compare_at_price_classes = base_text_class | append: 'h5 text-subdued line-through'
      assign unit_price_classes = base_text_class | append: 'h6 text-subdued'
  endcase
-%}

<price-list class="price-list {% if context == 'product' %}price-list--product{% endif %}">

  {%- if context == 'product' and product != blank -%}
    {%- assign variant = product.selected_or_first_available_variant -%}
    {%- assign pix_price = variant.price | times: 0.85 -%}
    <div class="PixPriceBox" style="margin-bottom: 6px;">
      <div style="font-size: 20px; font-weight: 600; color: #169c5b;">
        R$ {{ pix_price | money_without_currency | replace: '.', ',' }} <span style="font-weight: 400; font-size: 16px;">no PIX</span>
      </div>
    </div>
  {%- endif -%}

  {%- if variant != blank -%}
    <sale-price class="{% if variant.compare_at_price > variant.price %}{{ on_sale_price_classes }}{% else %}{{ regular_price_classes }}{% endif %}">
      <span class="sr-only">{{ 'product.price.sale_price' | t }}</span>
      {{ variant.price | money }}<span class="installment-note" style="font-weight: 400; font-size: 14px; margin-left: 4px;"> até 2x sem juros</span>
    </sale-price>

    {%- if variant.compare_at_price > variant.price -%}
      <compare-at-price class="{{ compare_at_price_classes }}">
        <span class="sr-only">{{ 'product.price.regular_price' | t }}</span>
        {{ variant.compare_at_price | money }}
      </compare-at-price>
    {%- endif -%}
  {%- endif -%}

</price-list>

<script>
function addInstallmentNote() {
  const priceEl = document.querySelector('sale-price');
  if (priceEl && !priceEl.innerHTML.includes('2x sem juros')) {
    const note = document.createElement('span');
    note.textContent = ' até 2x sem juros';
    note.style.fontWeight = '400';
    note.style.fontSize = '14px';
    note.style.marginLeft = '4px';
    priceEl.appendChild(note);
  }
}
document.addEventListener('DOMContentLoaded', addInstallmentNote);
document.addEventListener('shopify:section:load', addInstallmentNote);
document.addEventListener('shopify:section:select', addInstallmentNote);
document.addEventListener('variant:change', addInstallmentNote);
</script>
